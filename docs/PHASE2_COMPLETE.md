# Phase 2 å®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

Phase 2ï¼ˆæ‹–æ‹½åŠŸèƒ½ï¼‰å·²æˆåŠŸå®Œæˆï¼æœ¬é˜¶æ®µå®ç°äº†å®Œæ•´çš„æ‹–æ”¾ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä»èµ„æºé¢æ¿æ‹–æ‹½åª’ä½“åˆ°æ—¶é—´è½´ã€ç‰‡æ®µåœ¨æ—¶é—´è½´å†…æ‹–æ‹½ã€è·¨è½¨é“æ‹–æ‹½ä»¥åŠæ™ºèƒ½å¸é™„å¯¹é½åŠŸèƒ½ã€‚

**å®Œæˆæ—¶é—´**: 2024å¹´
**çŠ¶æ€**: âœ… å®Œæˆ
**é”™è¯¯æ•°**: 0
**è­¦å‘Šæ•°**: 12ï¼ˆå‡ä¸ºæœªä½¿ç”¨å˜é‡æˆ–æ ·å¼ä¼˜åŒ–å»ºè®®ï¼‰

---

## âœ… å®Œæˆæ¸…å•

### 1. DndContext é…ç½®

- [x] åœ¨ Timeline ç»„ä»¶ä¸­é…ç½® DndContext
- [x] é…ç½® PointerSensorï¼ˆ8px æ¿€æ´»è·ç¦»ï¼‰
- [x] å®ç° DragOverlay æ‹–æ‹½é¢„è§ˆ
- [x] å¤„ç† onDragStart äº‹ä»¶
- [x] å¤„ç† onDragEnd äº‹ä»¶

### 2. ResourceGrid æ‹–æ‹½æº

- [x] é‡æ„ ResourceItem ä¸ºç‹¬ç«‹ç»„ä»¶
- [x] ä½¿ç”¨ useDraggable Hook
- [x] é…ç½®æ‹–æ‹½æ•°æ®ï¼ˆDragDataï¼‰
- [x] æ·»åŠ æ‹–æ‹½è§†è§‰åé¦ˆ
  - æ‹–æ‹½ä¸­é€æ˜åº¦å˜åŒ–
  - æ‹–æ‹½å›¾æ ‡æ˜¾ç¤º
  - å…‰æ ‡å˜åŒ–ï¼ˆgrab/grabbingï¼‰
- [x] åª’ä½“ç±»å‹è‡ªåŠ¨è¯†åˆ«ï¼ˆvideo/audio/imageï¼‰

### 3. TimelineTrack æ”¾ç½®åŒºåŸŸ

- [x] ä½¿ç”¨ useDroppable Hook
- [x] é…ç½®æ”¾ç½®åŒºåŸŸæ•°æ®
- [x] æ·»åŠ æ‚¬åœé«˜äº®æ•ˆæœ
- [x] æ˜¾ç¤ºæ”¾ç½®æç¤ºæ–‡æœ¬
- [x] é”å®šè½¨é“ç¦ç”¨æ”¾ç½®

### 4. TimelineClip æ‹–æ‹½

- [x] ä½¿ç”¨ useDraggable Hook
- [x] é…ç½®ç‰‡æ®µæ‹–æ‹½æ•°æ®
- [x] å®ç°æ‹–æ‹½è§†è§‰åé¦ˆ
- [x] æ”¯æŒæ‹–æ‹½å˜æ¢ï¼ˆCSS Transformï¼‰
- [x] æ‹–æ‹½æ—¶é€æ˜åº¦å˜åŒ–

### 5. æ‹–æ‹½å¤„ç†é€»è¾‘

- [x] **èµ„æºæ‹–æ‹½åˆ°è½¨é“**
  - è®¡ç®—æ‹–æ”¾ä½ç½®ï¼ˆæ—¶é—´ï¼‰
  - åˆ›å»ºæ–°ç‰‡æ®µ
  - è®¾ç½®é»˜è®¤æ—¶é•¿
  - éªŒè¯è½¨é“çŠ¶æ€ï¼ˆé”å®š/ç±»å‹ï¼‰

- [x] **ç‰‡æ®µåœ¨æ—¶é—´è½´å†…æ‹–æ‹½**
  - åŒè½¨é“å†…æ—¶é—´è°ƒæ•´
  - è·¨è½¨é“ç§»åŠ¨
  - ä½ç½®è®¡ç®—
  - è¾¹ç•Œé™åˆ¶

### 6. å¸é™„å¯¹é½åŠŸèƒ½

- [x] å®ç° collectSnapPoints å‡½æ•°
- [x] å®ç° calculateSnappedTime å‡½æ•°
- [x] å¸é™„ç‚¹ç±»å‹æ”¯æŒï¼š
  - Playheadï¼ˆæ’­æ”¾å¤´ï¼‰
  - Clip Startï¼ˆç‰‡æ®µå¼€å§‹ï¼‰
  - Clip Endï¼ˆç‰‡æ®µç»“æŸï¼‰
  - Markerï¼ˆæ—¶é—´è½´èµ·ç‚¹ï¼‰
- [x] å¯é…ç½®å¸é™„é˜ˆå€¼
- [x] å·¥å…·æ å¸é™„å¼€å…³

### 7. æ‹–æ‹½é¢„è§ˆç»„ä»¶

- [x] åˆ›å»º ClipDragPreview ç»„ä»¶
- [x] æ˜¾ç¤ºåª’ä½“ç±»å‹å›¾æ ‡
- [x] æ˜¾ç¤ºèµ„æºåç§°
- [x] æ˜¾ç¤ºç‰‡æ®µæ—¶é•¿
- [x] åª’ä½“ç±»å‹é¢œè‰²åŒºåˆ†

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
cluv/frontend/app/editor/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ResourceGrid.tsx          âœ… é‡æ„ - æ·»åŠ æ‹–æ‹½æº
â”‚   â”œâ”€â”€ Timeline.tsx              âœ… æ›´æ–° - DndContext + æ‹–æ‹½å¤„ç†
â”‚   â”œâ”€â”€ TimelineTrack.tsx         âœ… æ›´æ–° - æ·»åŠ æ”¾ç½®åŒºåŸŸ
â”‚   â”œâ”€â”€ TimelineClip.tsx          âœ… æ›´æ–° - æ·»åŠ æ‹–æ‹½åŠŸèƒ½
â”‚   â”œâ”€â”€ ClipDragPreview.tsx       âœ… æ–°å»º - æ‹–æ‹½é¢„è§ˆç»„ä»¶
â”‚   â””â”€â”€ index.ts                  âœ… æ›´æ–° - å¯¼å‡ºæ–°ç»„ä»¶
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ timeline.ts               âœ… æ›´æ–° - æ·»åŠ å¸é™„å‡½æ•°
â””â”€â”€ types/
    â””â”€â”€ timeline.ts               âœ… å·²æœ‰ - DragData ç±»å‹
```

**æ–°å¢ä»£ç **: ~400 è¡Œ
**ä¿®æ”¹ä»£ç **: ~350 è¡Œ
**æ€»ä»£ç **: Phase 1 + Phase 2 = ~2,400+ è¡Œ

---

## ğŸ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒæ‹–æ‹½åŠŸèƒ½

âœ… **ä»èµ„æºé¢æ¿æ‹–æ‹½**
- æ‹–æ‹½ä»»æ„åª’ä½“èµ„æºåˆ°æ—¶é—´è½´
- è‡ªåŠ¨è¯†åˆ«åª’ä½“ç±»å‹ï¼ˆvideo/audio/imageï¼‰
- æ ¹æ®æ‹–æ”¾ä½ç½®è®¡ç®—å¼€å§‹æ—¶é—´
- è‡ªåŠ¨è®¾ç½®é»˜è®¤æ—¶é•¿ï¼ˆè§†é¢‘3ç§’ï¼ŒéŸ³é¢‘5ç§’ï¼‰
- éªŒè¯ç›®æ ‡è½¨é“ï¼ˆç±»å‹åŒ¹é…ã€éé”å®šï¼‰

âœ… **ç‰‡æ®µåœ¨æ—¶é—´è½´æ‹–æ‹½**
- åŒè½¨é“å†…æ°´å¹³æ‹–æ‹½è°ƒæ•´æ—¶é—´
- è·¨è½¨é“å‚ç›´æ‹–æ‹½
- å®æ—¶è§†è§‰åé¦ˆ
- è‡ªåŠ¨è¾¹ç•Œé™åˆ¶ï¼ˆä¸å°äº0ï¼‰

âœ… **æ™ºèƒ½å¸é™„å¯¹é½**
- è‡ªåŠ¨å¸é™„åˆ°æ’­æ”¾å¤´ä½ç½®
- å¸é™„åˆ°å…¶ä»–ç‰‡æ®µçš„èµ·æ­¢ç‚¹
- å¸é™„åˆ°æ—¶é—´è½´èµ·ç‚¹
- å¯é…ç½®å¸é™„é˜ˆå€¼ï¼ˆé»˜è®¤5åƒç´ ï¼‰
- å·¥å…·æ å¿«é€Ÿåˆ‡æ¢å¼€å…³

âœ… **è§†è§‰åé¦ˆ**
- æ‹–æ‹½æ—¶æºå¯¹è±¡åŠé€æ˜
- è‡ªå®šä¹‰æ‹–æ‹½é¢„è§ˆï¼ˆDragOverlayï¼‰
- æ”¾ç½®åŒºåŸŸé«˜äº®ï¼ˆè“è‰²è¾¹æ¡†ï¼‰
- æ”¾ç½®æç¤ºæ–‡æœ¬
- å…‰æ ‡çŠ¶æ€å˜åŒ–

### æ‹–æ‹½æ•°æ®æµ

```typescript
// èµ„æºæ‹–æ‹½æ•°æ®
interface DragData {
  resourceId: string;
  resourceName: string;
  resourceType: MediaType;  // 'video' | 'audio' | 'image' | 'text'
  resourceSrc: string;
}

// ç‰‡æ®µæ‹–æ‹½æ•°æ®
{
  type: "clip",
  clipId: string,
  trackId: string,
}

// è½¨é“æ”¾ç½®æ•°æ®
{
  type: "track",
  trackId: string,
  trackType: "video" | "audio",
}
```

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. DnD Kit é›†æˆ

- **PointerSensor**: 8px æ¿€æ´»è·ç¦»ï¼Œé¿å…è¯¯è§¦
- **DragOverlay**: è‡ªå®šä¹‰æ‹–æ‹½é¢„è§ˆï¼Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- **Droppable éªŒè¯**: é”å®šè½¨é“è‡ªåŠ¨ç¦ç”¨

### 2. æ™ºèƒ½ä½ç½®è®¡ç®—

```typescript
// ä»é¼ æ ‡ä½ç½®è®¡ç®—æ—¶é—´
const x = pointerEvent.clientX - rect.left;
const startTime = pixelsToTime(x + scrollLeft, pixelsPerSecond);

// è€ƒè™‘æ‹–æ‹½åç§»
const deltaX = event.delta.x;
const deltaTime = pixelsToTime(deltaX, pixelsPerSecond);
const newStartTime = clip.startTime + deltaTime;
```

### 3. å¸é™„ç®—æ³•

```typescript
// æ”¶é›†æ‰€æœ‰å¸é™„ç‚¹
const snapPoints = collectSnapPoints(allClips, currentTime, excludeClipId);

// è®¡ç®—æœ€è¿‘å¸é™„ç‚¹
const snapped = calculateSnappedTime(
  time,
  snapPoints,
  threshold,
  pixelsPerSecond
);

// åº”ç”¨å¸é™„
if (snapped.snapped) {
  time = snapped.time;
}
```

### 4. ç±»å‹å®‰å…¨çš„æ‹–æ‹½

- ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- æ‹–æ‹½æ•°æ®ç±»å‹éªŒè¯
- è¿è¡Œæ—¶ç±»å‹åˆ¤æ–­ï¼ˆ`"resourceId" in data`ï¼‰

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æ‹–æ‹½

```typescript
// 1. ä»èµ„æºé¢æ¿æ‹–æ‹½
// ç”¨æˆ·æ“ä½œï¼šç‚¹å‡»å¹¶æ‹–æ‹½èµ„æº â†’ æ‹–åˆ°è½¨é“ä¸Š â†’ é‡Šæ”¾
// ç»“æœï¼šåˆ›å»ºæ–°ç‰‡æ®µåœ¨æ‹–æ”¾ä½ç½®

// 2. ç‰‡æ®µåœ¨æ—¶é—´è½´æ‹–æ‹½
// ç”¨æˆ·æ“ä½œï¼šç‚¹å‡»å¹¶æ‹–æ‹½ç‰‡æ®µ â†’ ç§»åŠ¨åˆ°æ–°ä½ç½® â†’ é‡Šæ”¾
// ç»“æœï¼šç‰‡æ®µç§»åŠ¨åˆ°æ–°æ—¶é—´æˆ–æ–°è½¨é“

// 3. åˆ‡æ¢å¸é™„
const toggleSnapping = useTimelineStore((state) => state.toggleSnapping);
toggleSnapping(); // å¼€å¯/å…³é—­å¸é™„
```

### è‡ªå®šä¹‰å¸é™„é˜ˆå€¼

```typescript
const setSnapThreshold = useTimelineStore((state) => state.setSnapThreshold);
setSnapThreshold(10); // è®¾ç½®ä¸º10åƒç´ 
```

---

## ğŸ“Š æ‹–æ‹½æµç¨‹å›¾

```
èµ„æºæ‹–æ‹½æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ‹–æ‹½èµ„æº    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ResourceItem    â”‚
â”‚ useDraggable()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DragOverlay     â”‚
â”‚ æ˜¾ç¤ºé¢„è§ˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TimelineTrack   â”‚
â”‚ useDroppable()  â”‚
â”‚ é«˜äº®æ˜¾ç¤º        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onDragEnd       â”‚
â”‚ è®¡ç®—ä½ç½®        â”‚
â”‚ åº”ç”¨å¸é™„        â”‚
â”‚ åˆ›å»ºç‰‡æ®µ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰‡æ®µæ‹–æ‹½æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ‹–æ‹½ç‰‡æ®µ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TimelineClip    â”‚
â”‚ useDraggable()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‹–æ‹½ä¸­...       â”‚
â”‚ transform æ›´æ–°  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ”¾ç½®åˆ°è½¨é“      â”‚
â”‚ useDroppable()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onDragEnd       â”‚
â”‚ è®¡ç®—æ–°ä½ç½®      â”‚
â”‚ åº”ç”¨å¸é™„        â”‚
â”‚ æ›´æ–°/ç§»åŠ¨ç‰‡æ®µ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### å·²æµ‹è¯•åŠŸèƒ½

- [x] ä»èµ„æºé¢æ¿æ‹–æ‹½è§†é¢‘åˆ°è§†é¢‘è½¨é“
- [x] ä»èµ„æºé¢æ¿æ‹–æ‹½éŸ³é¢‘åˆ°éŸ³é¢‘è½¨é“
- [x] ç‰‡æ®µåœ¨åŒè½¨é“å†…æ‹–æ‹½
- [x] ç‰‡æ®µè·¨è½¨é“æ‹–æ‹½
- [x] æ‹–æ‹½åˆ°é”å®šè½¨é“ï¼ˆåº”è¢«é˜»æ­¢ï¼‰
- [x] å¸é™„åˆ°æ’­æ”¾å¤´
- [x] å¸é™„åˆ°å…¶ä»–ç‰‡æ®µ
- [x] å¸é™„å¼€å…³åŠŸèƒ½

### è¾¹ç•Œæƒ…å†µ

- [x] æ‹–æ‹½åˆ°æ—¶é—´è½´èµ·ç‚¹å‰ï¼ˆè‡ªåŠ¨é™åˆ¶åˆ°0ï¼‰
- [x] æ‹–æ‹½æ—¶å¿«é€Ÿç§»åŠ¨
- [x] è¿ç»­å¤šæ¬¡æ‹–æ‹½
- [x] æ‹–æ‹½å–æ¶ˆï¼ˆé‡Šæ”¾åœ¨éæ”¾ç½®åŒºï¼‰

---

## âš ï¸ å·²çŸ¥é—®é¢˜ä¸é™åˆ¶

### è½»å¾®é—®é¢˜

1. **æ‹–æ‹½æ€§èƒ½**
   - å¤§é‡ç‰‡æ®µæ—¶å¯èƒ½æœ‰è½»å¾®å»¶è¿Ÿ
   - å»ºè®®ï¼šåç»­å®ç°è™šæ‹ŸåŒ–ï¼ˆPhase 6ï¼‰

2. **ç¢°æ’æ£€æµ‹**
   - å½“å‰å…è®¸ç‰‡æ®µé‡å 
   - å»ºè®®ï¼šPhase 4 å®ç°ç¢°æ’é¢„é˜²

3. **æ’¤é”€/é‡åš**
   - æ‹–æ‹½æ“ä½œå°šæœªåŠ å…¥å†å²è®°å½•
   - å»ºè®®ï¼šPhase 4 å®ç°

### è®¾è®¡é™åˆ¶

1. **è·¨è½¨é“ç±»å‹é™åˆ¶**
   - å½“å‰æœªå¼ºåˆ¶ç±»å‹åŒ¹é…
   - å…è®¸è§†é¢‘ç‰‡æ®µæ‹–åˆ°éŸ³é¢‘è½¨é“ï¼ˆå¯èƒ½éœ€è¦é™åˆ¶ï¼‰

2. **æ‹–æ‹½æ‰‹æŸ„**
   - ç‰‡æ®µè¾¹ç¼˜è°ƒæ•´æ‰‹æŸ„æš‚æ—¶ç¦ç”¨
   - é¿å…ä¸æ‹–æ‹½åŠŸèƒ½å†²çª
   - å°†åœ¨ Phase 4 é‡æ–°å®ç°

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°ä¼˜åŒ–

- âœ… PointerSensor æ¿€æ´»è·ç¦»ï¼ˆå‡å°‘æ— æ„æ‹–æ‹½ï¼‰
- âœ… å¸é™„è®¡ç®—ä»…åœ¨å¯ç”¨æ—¶æ‰§è¡Œ
- âœ… ä½¿ç”¨ CSS Transformï¼ˆGPU åŠ é€Ÿï¼‰
- âœ… DragOverlay å‡å°‘é‡æ¸²æŸ“

### å¾…ä¼˜åŒ–é¡¹

- [ ] æ‹–æ‹½æ—¶èŠ‚æµä½ç½®æ›´æ–°
- [ ] å¤§é‡ç‰‡æ®µæ—¶çš„å¸é™„ç‚¹ä¼˜åŒ–
- [ ] è™šæ‹ŸåŒ–é•¿æ—¶é—´è½´

---

## ğŸ”§ é…ç½®é€‰é¡¹

### å¸é™„é…ç½®

```typescript
// é»˜è®¤é…ç½®ï¼ˆtypes/timeline.tsï¼‰
TIMELINE_CONFIG = {
  SNAP_THRESHOLD: 5,  // å¸é™„é˜ˆå€¼ï¼ˆåƒç´ ï¼‰
}

// è¿è¡Œæ—¶ä¿®æ”¹
const setSnapThreshold = useTimelineStore((state) => state.setSnapThreshold);
setSnapThreshold(10);

// åˆ‡æ¢å¸é™„
const toggleSnapping = useTimelineStore((state) => state.toggleSnapping);
toggleSnapping();
```

### æ‹–æ‹½ä¼ æ„Ÿå™¨é…ç½®

```typescript
// Timeline.tsx
const sensors = useSensors(
  useSensor(PointerSensor, {
    activationConstraint: {
      distance: 8,  // æ‹–æ‹½æ¿€æ´»è·ç¦»
    },
  })
);
```

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šPhase 3 - æ’­æ”¾åŒæ­¥

### ç›®æ ‡

å®ç° Timeline ä¸ PlayerArea çš„åŒå‘åŒæ­¥ã€‚

### ä»»åŠ¡æ¸…å•

- [ ] è¿æ¥ Timeline å’Œ PlayerArea
- [ ] æ’­æ”¾æ—¶è‡ªåŠ¨æ›´æ–° Playhead
- [ ] Playhead å˜åŒ–æ—¶æ›´æ–°æ’­æ”¾å™¨
- [ ] ä¿®æ”¹ PlayerArea æ”¯æŒå¤–éƒ¨æ§åˆ¶
- [ ] å®ç°æ’­æ”¾/æš‚åœæ§åˆ¶
- [ ] å®ç°å¸§ç²¾ç¡®è·³è½¬

### é¢„è®¡æ—¶é—´

2-3 å¤©

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [timeline-implementation-plan.md](./timeline-implementation-plan.md) - å®Œæ•´å®ç°è®¡åˆ’
- [PHASE1_COMPLETE.md](./PHASE1_COMPLETE.md) - Phase 1 å®ŒæˆæŠ¥å‘Š
- [timeline-usage-guide.md](./timeline-usage-guide.md) - ä½¿ç”¨æŒ‡å—

---

## ğŸ¯ API å˜æ›´

### æ–°å¢å‡½æ•°ï¼ˆutils/timeline.tsï¼‰

```typescript
// å¸é™„ç›¸å…³
collectSnapPoints(clips, currentTime, excludeClipId?): SnapPoint[]
calculateSnappedTime(time, snapPoints, threshold, pps): SnappedResult
getAllClipsFromTracks(tracks): Clip[]

// ç±»å‹å®šä¹‰
interface SnapPoint {
  time: number;
  type: 'clip-start' | 'clip-end' | 'playhead' | 'marker';
  clipId?: string;
}
```

### æ–°å¢ç»„ä»¶

```typescript
// ClipDragPreview.tsx
<ClipDragPreview data={dragData} type="resource" | "clip" />
```

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### è‡ªå®šä¹‰æ‹–æ‹½é¢„è§ˆ

```typescript
import { ClipDragPreview } from '@/app/editor/components';

<DragOverlay>
  {activeDragData ? (
    <ClipDragPreview data={activeDragData} type="resource" />
  ) : null}
</DragOverlay>
```

### æ‰‹åŠ¨è§¦å‘å¸é™„

```typescript
import { collectSnapPoints, calculateSnappedTime } from '@/app/editor/utils/timeline';

const allClips = getAllClipsFromTracks(tracks);
const snapPoints = collectSnapPoints(allClips, currentTime);
const result = calculateSnappedTime(
  targetTime,
  snapPoints,
  5,
  pixelsPerSecond
);

if (result.snapped) {
  console.log('Snapped to:', result.snapPoint?.type);
  // ä½¿ç”¨ result.time
}
```

---

## ğŸ‰ æ€»ç»“

Phase 2 æˆåŠŸå®ç°äº†å®Œæ•´çš„æ‹–æ”¾ç³»ç»Ÿï¼š

âœ… **åŠŸèƒ½å®Œæ•´** - æ”¯æŒæ‰€æœ‰è®¡åˆ’çš„æ‹–æ‹½åœºæ™¯
âœ… **ç”¨æˆ·ä½“éªŒ** - æµç•…çš„è§†è§‰åé¦ˆå’Œäº¤äº’
âœ… **æ™ºèƒ½å¯¹é½** - å¼ºå¤§çš„å¸é™„ç³»ç»Ÿ
âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒ
âœ… **æ€§èƒ½è‰¯å¥½** - GPU åŠ é€Ÿçš„æ‹–æ‹½åŠ¨ç”»

**ä»£ç è´¨é‡**: 0 é”™è¯¯ï¼Œç»“æ„æ¸…æ™°
**ç”¨æˆ·ä½“éªŒ**: ç›´è§‚æµç•…ï¼Œåé¦ˆåŠæ—¶
**å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æ‹–æ‹½ç±»å‹

æ‹–æ‹½ç³»ç»Ÿä¸ºç¼–è¾‘å™¨å¸¦æ¥äº†æ ¸å¿ƒäº¤äº’èƒ½åŠ›ï¼Œç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
- ğŸ“ ä»èµ„æºé¢æ¿æ‹–æ‹½åª’ä½“åˆ°æ—¶é—´è½´
- ğŸ¬ è‡ªç”±è°ƒæ•´ç‰‡æ®µåœ¨æ—¶é—´è½´ä¸Šçš„ä½ç½®
- ğŸ”„ åœ¨ä¸åŒè½¨é“é—´ç§»åŠ¨ç‰‡æ®µ
- ğŸ§² åˆ©ç”¨å¸é™„åŠŸèƒ½ç²¾ç¡®å¯¹é½

ç°åœ¨å¯ä»¥è¿›å…¥ Phase 3ï¼Œå®ç°æ’­æ”¾åŒæ­¥åŠŸèƒ½ï¼ğŸš€